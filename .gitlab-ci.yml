stages:
  - prepare
  - build_w10_x64

before_script:
  - "ln -s $CACHEDIR packer_cache"
  - "git submodule sync --recursive"
  - "git submodule update --init --recursive"

variables:
  TMPDIR: "$CI_PROJECT_DIR/../tmp"
  CACHEDIR: "$CI_PROJECT_DIR/../packer_cache"

prepare_job:
  stage: prepare
  script:
    - "mkdir -p $TMPDIR"
    - "mkdir -p $CACHEDIR"
  tags:
    - box_build

build_w10_x64_job:
  stage: build_w10_x64
  script:
    - "packer build -only=virtualbox-iso windows_10_x64.json"
    - "mv boxes/*.box $HOME/boxes/"
  tags:
    - box_build
  when: manual
